# Atlassian API 클라이언트 구현 상황

## 프로젝트 구조
```
/home/yjchoi/company/tm_setter/atlassian_api/
├── atlassian_api.py           # 메인 API 클라이언트 구현
├── test_atlassian_api.py      # 테스트 코드
├── 요구사항.md                # 기능 요구사항 문서
├── 구현 상황.md               # 현재 구현 상태 문서
└── TODO.md                    # 할 일 목록
```

## 구현된 클래스

### JiraAPI 클래스
**위치**: `atlassian_api.py`

**주요 기능**:
- **초기화**: 도메인 URL, 사용자 ID, 패스워드를 받아 인증 정보 설정
- **이슈 관리**:
  - `get_issue(issue_key)`: 특정 이슈 조회
  - `create_issue(project_key, issue_type, summary, description, **kwargs)`: 새 이슈 생성
  - `update_issue(issue_key, fields)`: 이슈 필드 업데이트
  - `delete_issue(issue_key)`: 이슈 삭제
  - `add_comment(issue_key, comment)`: 이슈에 댓글 추가
- **프로젝트 관리**:
  - `get_projects()`: 전체 프로젝트 목록 조회
  - `get_project(project_key)`: 특정 프로젝트 정보 조회
- **검색**:
  - `search_issues(jql, max_results, start_at)`: JQL을 사용한 이슈 검색
- **사용자**:
  - `get_current_user()`: 현재 인증된 사용자 정보 조회

### ConfluenceAPI 클래스
**위치**: `atlassian_api.py`

**주요 기능**:
- **초기화**: 도메인 URL에 자동으로 `/wiki` 경로 추가
- **페이지 관리**:
  - `get_page_by_id(page_id, expand)`: ID로 페이지 조회
  - `get_page_by_title(space_key, title)`: 제목으로 페이지 검색
  - `create_page(space_key, title, content, parent_id)`: 새 페이지 생성
  - `update_page(page_id, title, content, version)`: 페이지 업데이트
  - `delete_page(page_id)`: 페이지 삭제
- **Space 관리**:
  - `get_spaces(limit)`: Space 목록 조회
  - `get_space(space_key)`: 특정 Space 정보 조회
- **검색**:
  - `search_content(cql, limit)`: CQL을 사용한 콘텐츠 검색
- **첨부파일**:
  - `get_attachments(page_id)`: 페이지의 첨부파일 목록 조회
  - `upload_attachment(page_id, file_path)`: 파일 업로드 (multipart/form-data 지원)

### BitbucketAPI 클래스
**위치**: `atlassian_api.py`

**주요 기능**:
- **초기화**: Cloud/Server 버전 자동 감지 (URL 기반)
  - Cloud: API 버전 2.0 사용
  - Server: API 버전 1.0 사용
- **저장소 관리**:
  - `get_repositories(workspace)`: 저장소 목록 조회
  - `get_repository(workspace, repo_slug)`: 특정 저장소 조회
  - `create_repository(workspace, repo_slug, is_private, description)`: 저장소 생성
  - `delete_repository(workspace, repo_slug)`: 저장소 삭제
- **브랜치 관리**:
  - `get_branches(workspace, repo_slug)`: 브랜치 목록 조회
  - `get_branch(workspace, repo_slug, branch_name)`: 특정 브랜치 조회
  - `create_branch(workspace, repo_slug, branch_name, target_hash)`: 브랜치 생성
- **Pull Request**:
  - `get_pull_requests(workspace, repo_slug, state)`: PR 목록 조회
  - `get_pull_request(workspace, repo_slug, pr_id)`: 특정 PR 조회
  - `create_pull_request(...)`: PR 생성
  - `merge_pull_request(workspace, repo_slug, pr_id)`: PR 병합
- **커밋**:
  - `get_commits(workspace, repo_slug, branch)`: 커밋 목록 조회
  - `get_commit(workspace, repo_slug, commit_hash)`: 특정 커밋 조회
- **웹훅**:
  - `get_webhooks(workspace, repo_slug)`: 웹훅 목록 조회
  - `create_webhook(workspace, repo_slug, url, events)`: 웹훅 생성

## 테스트 구현
**위치**: `test_atlassian_api.py`

### 테스트 클래스
- **TestJiraAPI**: JIRA API 클라이언트 테스트 (6개 테스트)
  - 초기화, 이슈 조회/생성, JQL 검색, 에러 처리
- **TestConfluenceAPI**: Confluence API 테스트 (5개 테스트)
  - 초기화, 페이지 조회/생성, CQL 검색, 첨부파일 업로드
- **TestBitbucketAPI**: Bitbucket API 테스트 (6개 테스트)
  - Cloud/Server 구분, 저장소 관리, PR 생성, 커밋 조회, 웹훅
- **TestIntegration**: 통합 테스트 (1개 테스트)
  - 메인 함수 실행 플로우

### 테스트 결과
- 총 17개 테스트 모두 통과
- Mock 객체를 사용한 단위 테스트
- 실제 API 호출 없이 기능 검증

## 기술적 특징

### 공통 구현
- **인증**: Basic Authentication 사용 (user_id, password/token)
- **헤더**: JSON Accept/Content-Type 설정
- **에러 처리**: `requests.exceptions.RequestException` 캐치 후 한글 에러 메시지
- **타입 힌트**: 모든 메서드 파라미터와 반환값에 타입 명시

### 특별 구현
- **Confluence 파일 업로드**: multipart/form-data 처리
- **Bitbucket Cloud/Server 호환**: URL 기반 자동 버전 감지
- **JIRA 리치 텍스트**: Atlassian Document Format 지원

## 사용 예제
메인 함수(`main()`)에서 대화형 CLI 제공:
1. 서비스 선택 (JIRA/Confluence/Bitbucket)
2. 인증 정보 입력
3. 기본 API 호출 예제 실행

## 의존성
- Python 3.x
- requests 라이브러리
- typing (표준 라이브러리)
- unittest (표준 라이브러리)